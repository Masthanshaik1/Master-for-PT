pipeline {
    agent any

    stages {

        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        stage('Run JMeter Tests') {
            steps {
                script {
                    sh '''
                    docker run --rm \
                        -v $WORKSPACE:/tests \
                        jmeter-with-plugins \
                        /bin/bash -c "cd /tests && jmeter -n -t your_test.jmx -l result.jtl -e -o HTMLReport"
                    '''
                }
            }
        }

        stage('Archive Results') {
            steps {
                archiveArtifacts artifacts: 'result.jtl'
                archiveArtifacts artifacts: 'HTMLReport/**'
            }
        }
    }
}
