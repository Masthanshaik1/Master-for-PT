pipeline {
    agent any
    stages {
        stage('Run JMeter Tests') {
            steps {
                script {
                    bat """
                    docker run --rm ^
                        -v "%WORKSPACE%:/tests" ^
                        jmeter-with-plugins ^
                        /opt/apache-jmeter-5.6.3/bin/jmeter ^
                        -n -t /tests/webtours1610.jmx ^
                        -l /tests/results.jtl
                    """
                }
            }
        }
        stage('Archive Results') {
            steps {
                archiveArtifacts artifacts: 'results.jtl', fingerprint: true
            }
        }
    }
}
